<?xml version="1.0" encoding="UTF-8"?>
<form>
	<attributes>
		<attribute name="action">?ext=calendar&amp;controller=event</attribute>
		<attribute name="name">event</attribute>
	</attributes>
	<hiddenFields>
		<field name="id" />
	</hiddenFields>

	<fieldsets>

		<fieldset name="main">
			<legend>Data of the event</legend>
			<elements>

				<field type="textinput" name="title">
					<label>core.title</label>
					<required />
				</field>

				<field type="select" name="eventtype">
					<label>event.attr.eventtype</label>
					<source type="function">
						<function>TodoyuCalendarViewHelper::getEventTypeOptions</function>
					</source>
					<noPleaseSelect />
					<required />
				</field>

				<field type="checkbox" name="is_dayevent">
					<label>event.attr.is_dayevent</label>
					<onchange>Todoyu.Ext.calendar.Event.Edit.setFulldayTime(this)</onchange>
				</field>

				<field type="checkbox" name="is_private">
					<label>event.attr.is_private</label>
					<validate>
						<user msg="LLL:event.error.privateEvent">
							<function>TodoyuEventFormValidator::eventIsAssignableToCurrentPersonOnly</function>
						</user>
					</validate>
				</field>

				<field type="datetimeinput" name="date_start">
					<label>event.attr.startdate</label>
					<extraAttributes>onchange="Todoyu.Ext.calendar.Event.updateEnddate('event')"</extraAttributes>
					<class>datetime</class>
					<required label="event.error.date_start" />
				</field>

				<field type="datetimeinput" name="date_end">
					<label>event.attr.enddate</label>
					<validate>
						<dateTimeNotBefore msg="event.error.starttimeAfterEndtime">
							<field>date_start</field>
							<allow>
								<fieldEquals>
									<field>eventtype</field>
									<!-- @todo use constant EVENTTYPE_REMINDER instead of hard value -->
									<value>13</value>
								</fieldEquals>
							</allow>
						</dateTimeNotBefore>
					</validate>
					<class>datetime</class>
				</field>
			</elements>
		</fieldset>

		<fieldset name="details">
			<legend>Details</legend>
			<elements>

				<field type="textinput" name="place">
					<label>event.attr.place</label>
				</field>

				<field type="textarea" name="description">
					<label>core.description</label>
				</field>

				<field type="databaseRelation" name="persons">
					<addLabel>contact.person.new</addLabel>
					<label>event.attr.assigned_to</label>
					<record>
						<form>ext/calendar/config/form/event-person.xml</form>
						<url>
							<ext>calendar</ext>
							<controller>event</controller>
						</url>
						<label type="function">
							<function>TodoyuContactViewHelper::getPersonLabel</function>
							<noLabel>event.attr.assigned_to.noLabel</noLabel>
						</label>
					</record>
					<validate>
						<user msg="LLL:event.error.overbooked">
							<function>TodoyuEventFormValidator::personsAreBookable</function>
						</user>
						<user msg="LLL:event.error.hasInternalPerson">
							<function>TodoyuEventFormValidator::hasInternalPerson</function>
						</user>
					</validate>
					<required />
				</field>
<!--
				<field type="textinputAC" name="id_project">
					<label>event.attr.id_project</label>
					<config>
						<acName>project</acName>
						<acLabel>TodoyuProjectManager::getLabel</acLabel>
					</config>
				</field>

				<field type="textinputAC" name="id_task">
					<label>event.attr.id_task</label>
					<config>
						<acName>task</acName>
						<acLabel>TodoyuTaskManager::getLabel</acLabel>
					</config>
				</field>
-->
			</elements>
		</fieldset>

		<fieldset name="buttons">
			<legend>Actions</legend>
			<class>buttons</class>
			<elements>

				<field type="cancelButton" name="cancel">
					<onclick>Todoyu.Ext.calendar.Event.Edit.cancelEdit()</onclick>
				</field>

				<field type="saveButton" name="save">
					<onclick>Todoyu.Ext.calendar.Event.Edit.saveEvent()</onclick>
				</field>

			</elements>
		</fieldset>

	</fieldsets>
</form>