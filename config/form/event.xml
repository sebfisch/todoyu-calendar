<?xml version="1.0" encoding="UTF-8"?>
<form>
	<attributes>
		<attribute name="action">?ext=calendar&amp;controller=event</attribute>
		<attribute name="name">event</attribute>
		<attribute name="onsubmit">return false</attribute>
		<attribute name="class">formEvent</attribute>
	</attributes>
	<hiddenFields>
		<field name="id" />
	</hiddenFields>

	<fieldsets>

		<fieldset name="main">
			<legend>Data of the event</legend>
			<elements>

				<field type="textinput" name="title">
					<label>core.title</label>
					<required />
				</field>

				<field type="select" name="eventtype">
					<label>event.attr.eventtype</label>
					<source type="function">
						<function>TodoyuCalendarViewHelper::getEventTypeOptions</function>
					</source>
					<required />
				</field>

				<field type="checkbox" name="is_dayevent">
					<label>event.attr.is_dayevent</label>
				</field>

				<field type="checkbox" name="is_public">
					<label>event.attr.is_public</label>
				</field>

				<field type="checkbox" name="is_private">
					<label>event.attr.is_private</label>
					<validate>
						<user msg="LLL:event.error.privateEvent">
							<function>TodoyuEventFormValidator::eventIsAssignableToCurrentUserOnly</function>
						</user>
					</validate>
				</field>

				<field type="datetimeinput" name="date_start">
					<label>event.attr.startdate</label>
					<extraAttributes>onchange="Todoyu.Ext.calendar.Event.updateEnddate('event')"</extraAttributes>
					<class>datetime</class>
					<required label="event.error.date_start" />
				</field>

				<field type="datetimeinput" name="date_end">
					<label>event.attr.enddate</label>
					<validate>
						<dateTimeNotBefore msg="form.error.endDateNotBeforeStart">
							<field>date_start</field>
						</dateTimeNotBefore>
					</validate>
					<class>datetime</class>
				</field>
			</elements>
		</fieldset>

		<fieldset name="details">
			<legend>Details</legend>
			<elements>

				<field type="textinput" name="place">
					<label>event.attr.place</label>
				</field>

				<field type="textarea" name="description">
					<label>core.description</label>
				</field>

				<field type="databaseRelation" name="user">
					<label>event.attr.assigned_to</label>
					<foreignRecordConf>
						<foreignformxml>ext/calendar/config/form/event-user.xml</foreignformxml>
						<addSubformConfig>
							<ext>calendar</ext>
							<controller>formhandling</controller>
						</addSubformConfig>
						<label type="function">
							<function>TodoyuUserViewHelper::getUserLabel</function>
							<noLabel>event.attr.assigned_to.noLabel</noLabel>
						</label>
						<validateRequired>TodoyuUserViewHelper::validateRequiredUserAC</validateRequired>
					</foreignRecordConf>
					<required />

					<validate>
						<user msg="LLL:event.error.overbooked">
							<function>TodoyuEventFormValidator::usersAreBookable</function>
						</user>
					</validate>

				</field>
<!--
				<field type="textinputAC" name="id_project">
					<label>event.attr.id_project</label>
					<config>
						<acListener>
								<ext>calendar</ext>
								<controller>autocompletion</controller>
								<action>project</action>
						</acListener>
						<acLabelFunc>TodoyuProjectManager::getLabel</acLabelFunc>
					</config>
				</field>

				<field type="textinputAC" name="id_task">
					<label>event.attr.id_task</label>
					<config>
						<acListener>
								<ext>calendar</ext>
								<controller>autocompletion</controller>
								<action>task</action>
						</acListener>
						<acLabelFunc>TodoyuTaskManager::getLabel</acLabelFunc>
					</config>
				</field>
-->
			</elements>
		</fieldset>

		<fieldset name="buttons">
			<legend>Actions</legend>
			<class>buttons</class>
			<elements>
				<field type="saveButton" name="save">
					<onclick>Todoyu.Ext.calendar.EventEdit.saveEvent()</onclick>
				</field>
				<field type="cancelButton" name="cancel">
					<onclick>Todoyu.Ext.calendar.EventEdit.cancelEdit()</onclick>
				</field>
			</elements>
		</fieldset>

	</fieldsets>
</form>